{% extends "master.html" %}

{% block title %}
Foodstuff Price List
{% endblock %}

{% block content %}
<!DOCTYPE html>
<html>
<head>
    <style>
    p {
        margin-bottom: 100px;
    }
    </style>
</head>
<body>

<h4>Summary of Prices</h4>
<p>Here is a summary of all prices on the Price Store today: 

    <div id="summary"></div>

    <script>
        // Fetch food data from the Django backend
        fetch('/food-count/')
            .then(response => response.json())  // Parse the JSON response
            .then(data => {
                console.log(data);
                const foodItems = data;

                // Calculate average price for each food item
                const summary = {};
                foodItems.forEach(item => {
                    if (!summary[item.foodstuff]) {
                        summary[item.foodstuff] = {
                            total: 0,
                            count: 0
                        };
                    }
                    summary[item.foodstuff].total += item.price;
                    summary[item.foodstuff].count += 1;
                });

                // Create and display the summary
                let summaryHtml = "";
                for (const foodName in summary) {
                    const avgPrice = (summary[foodName].total / summary[foodName].count).toFixed(2);
                    summaryHtml += `<p><strong>${foodName}:</strong> Average Price = â‚¦${avgPrice}</p>`;
                }

                console.log(summaryHtml);
                document.getElementById('summary').innerHTML = summaryHtml;
            })
            .catch(error => console.error('Error fetching data:', error));
    </script>
</p>

<h4>List of Prices ðŸ“ƒ</h4>
{% for price in prices %}
    <article class='list'>
        {{ price.foodstuff }} at {{ price.price }} naira â€¢ submitted by {{ price.author }}
    </article>
{% endfor %}

</body>
</html>
{% endblock %}
