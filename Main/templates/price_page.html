{% extends "master.html" %}
{% load static %}

{% block content %}
<style>
Â  body {
Â  Â  padding-top: 100px; /* fixes content hidden by navbar */
Â  }

Â  .card-container {
Â  Â  display: flex;
Â  Â  flex-wrap: wrap;
Â  Â  justify-content: center;
Â  Â  gap: 20px;
Â  }

Â  .card {
Â  Â  flex: 1 1 280px; /* responsive width */
Â  Â  max-width: 320px;
Â  Â  padding: 20px;
Â  Â  background: #fff;
Â  Â  border-radius: 14px;
Â  Â  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
Â  Â  text-align: left;
Â  Â  transition: transform 0.2s ease, box-shadow 0.2s ease;
Â  }

Â  .card h3 {
Â  Â  font-size: 18px;
Â  Â  font-weight: bold;
Â  Â  color: #222;
Â  Â  margin-bottom: 10px;
Â  }

Â  .card p {
Â  Â  margin: 6px 0;
Â  Â  color: #444;
Â  Â  font-size: 14px;
Â  Â  line-height: 1.4;
Â  }

Â  .card:hover {
Â  Â  transform: translateY(-5px);
Â  Â  box-shadow: 0 8px 18px rgba(0,0,0,0.15);
Â  }

  /* New Feature Cards CSS */
  .row.g-4 {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem; /* g-4 equivalent */
  }

  .col-md-4 {
    flex: 1 0 calc(33.333% - 1rem); /* 3 cards per row */
    max-width: calc(33.333% - 1rem);
  }
  
</style>

<div class="container mx-auto px-4 py-16">
Â  Â  <div class="row g-4 mb-4">
Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  <div class="card shadow-sm h-100">
Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title fw-bold">Basket of Essentials</h5>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-text">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Weekly estimate of staple foods (rice, beans, garri, yam, oil).Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  See how much it costs to feed a family of 4 per week.
Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  <ul class="ms-3 text-muted">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Rice (50kg) â€“ â‚¦X</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Beans (50kg) â€“ â‚¦Y</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Garri (50kg) â€“ â‚¦Z</li>
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  <div class="card shadow-sm h-100">
Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title fw-bold">Price Trends</h5>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-text">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Monitor price changes over time. Track whether food prices are rising or falling.
Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  <ul class="ms-3 text-muted">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Rice â¬†ï¸ +5% this week</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Beans â¬‡ï¸ -2% this week</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Yam â¡ï¸ stable</li>
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  <div class="card shadow-sm h-100">
Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title fw-bold">Regional Comparison</h5>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-text">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Compare average food basket costs across regions.Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Find out where food is cheapest or most expensive.
Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  <ul class="ms-3 text-muted">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>North: â‚¦A</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>South: â‚¦B</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>West: â‚¦C</li>
Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  Â  <div class="card-container mt-8">
Â  Â  <div class="card">
Â  Â  Â  <h3>Cheapest Foodstuff</h3>
Â  Â  Â  <p>Rice â€“ â‚¦32,000 per bag</p>
Â  Â  Â  <p>Yam â€“ â‚¦1,500 per tuber</p>
Â  Â  </div>

Â  Â  <div class="card">
Â  Â  Â  <h3>Most Expensive Foodstuff</h3>
Â  Â  Â  <p>Beans â€“ â‚¦65,000 per bag</p>
Â  Â  Â  <p>Garri â€“ â‚¦28,000 per bag</p>
Â  Â  </div>

Â  Â  <div class="card">
Â  Â  Â  <h3>Top 3 States with Lowest Prices</h3>
Â  Â  Â  <p>Kano, Kaduna, Niger</p>
Â  Â  </div>
Â  </div>

Â  Â  <div class="card-container mt-8">
Â  Â  <div class="card">
Â  Â  Â  <h3>Average Basket Price</h3>
Â  Â  Â  <p>Current average: â‚¦15,300 (across 10 staples)</p>
Â  Â  </div>

Â  Â  <div class="card">
Â  Â  Â  <h3>Price Trends</h3>
Â  Â  Â  <p>Weekly changes show rice dropping by 3% while beans increased by 5%.</p>
Â  Â  </div>

Â  Â  <div class="card">
Â  Â  Â  <h3>Regional Insights</h3>
Â  Â  Â  <p>South-South is consistently the most expensive region.</p>
Â  Â  </div>
Â  </div>
</div>

<div class="container mt-4">
Â  <div class="accordion" id="priceAccordion">
Â  Â  Â  Â  <div class="accordion-item">
Â  Â  Â  <h2 class="accordion-header" id="headingCheapest">
Â  Â  Â  Â  <button class="accordion-button text-success" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCheapest" aria-expanded="true" aria-controls="collapseCheapest">
Â  Â  Â  Â  Â  <b>Average Food Prices</b>
Â  Â  Â  Â  </button>
Â  Â  Â  </h2>
Â  Â  Â  Â  <div id="collapseCheapest" class="accordion-collapse collapse show" aria-labelledby="headingCheapest" data-bs-parent="#priceAccordion">
Â  Â  Â  Â  Â  Â  <div class="accordion-body">
Â  Â  Â  Â  Â  Â  Â  <li class="list-group-item d-flex justify-content-between align-items-center">Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="summary">Loading summary...</div>
Â  Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="accordion-item">
Â  Â  Â  <h2 class="accordion-header" id="headingExpensive">
Â  Â  Â  Â  <button class="accordion-button collapsed text-danger" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExpensive" aria-expanded="false" aria-controls="collapseExpensive">
Â  Â  Â  Â  Â  <b>Real-time Foodstuff Prices List</b>
Â  Â  Â  Â  </button>
Â  Â  Â  </h2>
Â  Â  Â  <div id="collapseExpensive" class="accordion-collapse collapse" aria-labelledby="headingExpensive" data-bs-parent="#priceAccordion">
Â  Â  Â  Â  <div class="accordion-body">
Â  Â  Â  Â  Â  <p>This list is updated in real-time. ğŸ˜ For your convenience, the newest listings appear at the top.</p>
Â  Â  Â  Â  Â  Â  {% for price in prices %}
Â  Â  Â  Â  Â  Â  Â  Â  <article class='list'>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â {{ price.author }} at {{ price.lga }}, {{ price.state }} posted: <b>{{ price.foodstuff }} - {{ price.price }}</b> naira â€¢ {{ price.created_at|date:"M d, Y H:i" }}Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  </article>
Â  Â  Â  Â  Â  Â  {% empty %}
Â  Â  Â  Â  Â  Â  Â  Â  <p>No food prices listed yet</p>
Â  Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
Â  Â  window.onload = function () {
Â  Â  Â  Â  fetch('/food-count/')
Â  Â  Â  Â  Â  Â  .then(response => response.json())
Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  const summary = {};

Â  Â  Â  Â  Â  Â  Â  Â  data.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!summary[item.foodstuff]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  summary[item.foodstuff] = { total: 0, count: 0 };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  summary[item.foodstuff].total += item.price;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  summary[item.foodstuff].count += 1;
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  let summaryHtml = "<h5>Average Prices:</h5><ul>";
Â  Â  Â  Â  Â  Â  Â  Â  for (const foodName in summary) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const avgPrice = (summary[foodName].total / summary[foodName].count).toFixed(2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  summaryHtml += `<strong>${foodName}:</strong> â‚¦${avgPrice}Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  summaryHtml += "</ul>";

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('summary').innerHTML = summaryHtml;
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error fetching data:', error);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('summary').innerText = "Could not load summary.";
Â  Â  Â  Â  Â  Â  });
Â  Â  }
</script>
{% endblock %}
